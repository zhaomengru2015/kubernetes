vector:
  nameOverride: "vector-aggregator"
  fullnameOverride: "vector-aggregator"
  role: Aggregator
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 300m
      memory: 640Mi
  logLevel: "info"
  podAnnotations:
    prometheus.io/port: "9598"
    prometheus.io/scrape: "true"
  containerPorts:
    - name: vector
      containerPort: 8686
      protocol: TCP
    - name: metrics
      containerPort: 9598
      protocol: TCP
  customConfig:
    data_dir: /vector-data-dir
    api:
      enabled: false
    sources:
      vector:
        type: vector
        address: 0.0.0.0:8686
        version: "2"
    transforms:
      kubernetes_logs_mutate_fields:
        type: remap
        inputs:
          - vector
        source: |-
          log_message = .message

          # add lf_dc_name field from env var for all logs
          .lf_dc_name = get_env_var!("lf_dc_name")

          #TODO: mutations for modesecurity logs, is it still needed?
          if .kubernetes.pod_namespace == "ingress-nginx" && contains!(log_message, "modsecurity") {
              .waf = "modsecurity"
          }
    sinks:
      stdout:
        type: console
        inputs: ["vector"]
        target: stdout
        encoding:
          codec: json
  haproxy:
    enabled: true
    existingConfigMap: vector-haproxy
    containerPorts:
      - name: vector
        containerPort: 8686
        protocol: TCP
      - name: metrics
        containerPort: 9598
        protocol: TCP
    service:
      ports:
        - name: vector
          port: 8686
          protocol: TCP
          targetPort: 8686
        - name: metrics
          port: 9598
          protocol: TCP
          targetPort: 9598
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 100m
        memory: 128Mi
